package org.fortiss.smg.webrest.impl;import java.util.concurrent.TimeoutException;import org.eclipse.jetty.servlet.ServletHolder;import org.fortiss.smg.ambulance.api.AmbulanceInterface;import org.fortiss.smg.ambulance.api.AmbulanceQueueNames;import org.fortiss.smg.remoteframework.lib.DefaultProxy;import org.fortiss.smg.remoteframework.lib.DefaultServer;import org.fortiss.smg.webrest.api.WebRestInterface;import org.fortiss.smg.webrest.api.WebRestQueueNames;import org.fortiss.smg.webrest.impl.jersey.JerseyApplication;import org.fortiss.smg.webrest.impl.jersey.ServerController;import org.fortiss.smg.webrest.impl.jersey.URIServletContainer;import org.osgi.framework.BundleActivator;import org.osgi.framework.BundleContext;import org.slf4j.LoggerFactory;public class WebRestActivator implements BundleActivator {	DefaultServer<WebRestInterface> server;	private ServerController serverREST;	// WebRestImpl impl;	// Logger from sl4j	private static org.slf4j.Logger logger = LoggerFactory			.getLogger(WebRestActivator.class);		@Override	public void start(BundleContext context) throws Exception {		System.out.println("WebRestActivator :: start() :: 1");		DefaultProxy<AmbulanceInterface> ambulanceClient = new DefaultProxy<AmbulanceInterface>(				AmbulanceInterface.class,				AmbulanceQueueNames.getAmbulanceQueue(), 5000);		System.out.println("WebRestActivator :: start() :: 2");		AmbulanceInterface ambuInt = ambulanceClient.init();		ambuInt.registerComponent(WebRestQueueNames.getWebRestInterfaceQueue(), "REST");		ambulanceClient.destroy();				System.out.println("WebRestActivator :: start() :: 3");				BundleFactory.activate();		System.out.println("WebRestActivator :: start() :: 4");				try {				System.out.println("WebRestActivator :: start() :: BundleFactory.activated: " + BundleFactory.getIKeyManager().getKey("68a45057-5734-4dad-9f86-ab9e32c4506e"));		}		catch (TimeoutException e) {			System.out.println("WebRestActivator :: start() :: 5");		}		catch (Exception e) {			System.out.println("WebRestActivator :: start() :: 6");		}				serverREST = new ServerController("localhost", 8091);				System.out.println("WebRestActivator :: start() :: 7");		serverREST.setServletContext(new ServletHolder(new URIServletContainer(new JerseyApplication())));				System.out.println("WebRestActivator :: Starting Server"); 		serverREST.start();		System.out.println("WebRestActivator :: start() :: 8");		serverREST.getServerStatus();		System.out.println("WebRestActivator :: start() :: 9");				// BY Shah, replaced with above written method calls ---------------------> STARTS/*		// set here our port for REST		serverREST = new ServerController();		//TODO: JerseyApp is strange. I can't really understand this		serverREST.start(8091, new ServletHolder(new URIServletContainer(new JerseyApplication())));*/		// BY Shah, replaced with above written method calls ---------------------> ENDS		}	@Override	public void stop(BundleContext context) throws Exception {		// REMEMBER to destroy all resources, threads and do cleanup		// server.destroy();		System.out.print("WebRestActivator :: I am stoping here");		serverREST.stop();				logger.info("WebRest is dead");	}}